<!-- MÓDULO: FOLHA DE PAGAMENTO -->
<div class="animate-fade-in">
    
    <!-- Cabeçalho do Módulo -->
    <div class="flex flex-col md:flex-row justify-between items-center mb-6">
        <div>
            <h3 class="text-2xl font-bold text-slate-800">Folha de Pagamento</h3>
            <p class="text-slate-500 text-sm">Gestão de vencimentos, líquida e distribuição bancária.</p>
        </div>
        
        <!-- Navegação Interna (Abas) -->
        <div class="bg-white p-1.5 rounded-xl border border-slate-200 shadow-sm flex mt-4 md:mt-0 overflow-x-auto max-w-full">
            <button onclick="folha.switchView('operacional')" id="tab-folha-operacional" class="px-4 py-2 rounded-lg text-sm font-bold transition whitespace-nowrap bg-yellow-50 text-yellow-800 shadow-sm border border-yellow-100">
                <i class="fa-solid fa-file-invoice-dollar mr-2"></i> Geral (Totais)
            </button>
            <button onclick="folha.switchView('outros-bancos')" id="tab-folha-outros-bancos" class="px-4 py-2 rounded-lg text-sm font-bold text-slate-500 hover:bg-slate-50 transition whitespace-nowrap">
                <i class="fa-solid fa-money-bill-transfer mr-2"></i> Outros Bancos
            </button>
            <button onclick="folha.switchView('gerencial')" id="tab-folha-gerencial" class="px-4 py-2 rounded-lg text-sm font-bold text-slate-500 hover:bg-slate-50 transition whitespace-nowrap">
                <i class="fa-solid fa-chart-line mr-2"></i> Relatório Anual
            </button>
        </div>
    </div>

    <!-- VIEW 1: OPERACIONAL (LANÇAMENTOS TOTAIS) -->
    <div id="view-folha-operacional">
        
        <!-- Formulário de Lançamento -->
        <div class="card-dashboard p-6 mb-8 border-l-4 border-l-yellow-500">
            <h4 class="font-bold text-slate-700 mb-4 text-sm uppercase tracking-wide">Dados da Competência</h4>
            
            <form id="formFolha" onsubmit="folha.handleSave(event)">
                <!-- Campo Oculto para Edição -->
                <input type="hidden" name="id" id="idFolhaEdicao">

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div>
                        <label class="label-padrao">Competência</label>
                        <input type="month" name="competencia" id="inputCompetenciaFolha" required class="input-padrao font-bold text-slate-700">
                    </div>
                    <div>
                        <label class="label-padrao">Tipo de Folha</label>
                        <select name="tipoFolha" id="selectTipoFolha" required class="input-padrao font-medium">
                            <option value="">Carregando...</option>
                        </select>
                    </div>
                    <div>
                        <label class="label-padrao text-emerald-600">Total Bruto (R$)</label>
                        <input type="text" name="valorBruto" id="folhaBruto" required class="input-padrao mask-money font-bold text-lg" oninput="folha.calcularLiquido()">
                    </div>
                    <div>
                        <label class="label-padrao text-red-500">Total Descontos (R$)</label>
                        <input type="text" name="valorDescontos" id="folhaDescontos" required class="input-padrao mask-money font-bold text-lg text-red-600" oninput="folha.calcularLiquido()">
                    </div>
                    <div class="lg:col-span-4">
                        <label class="label-padrao">Observações</label>
                        <textarea name="observacoes" id="inputObsFolha" rows="1" class="input-padrao resize-none" placeholder="Detalhes do lançamento..."></textarea>
                    </div>
                </div>

                <div class="mt-6 flex flex-col md:flex-row justify-between items-center gap-4 border-t border-slate-100 pt-6">
                    <div class="text-center md:text-left bg-slate-50 px-4 py-2 rounded-lg border border-slate-200">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block">Valor Líquido Calculado</span>
                        <span id="displayLiquido" class="text-2xl font-black text-slate-800">R$ 0,00</span>
                    </div>
                    
                    <div class="flex gap-3 w-full md:w-auto">
                        <button type="button" onclick="folha.cancelarEdicao()" id="btnCancelFolha" class="btn-secondary hidden border-red-200 text-red-600 hover:bg-red-50 flex-1 md:flex-none">
                            <i class="fa-solid fa-xmark mr-2"></i> Cancelar
                        </button>
                        <button type="submit" id="btnSalvarFolha" class="btn-primary flex-1 md:flex-none bg-yellow-500 hover:bg-yellow-600 border-none text-white shadow-lg shadow-yellow-500/30">
                            <i class="fa-solid fa-check mr-2"></i> Salvar Lançamento
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Histórico -->
        <div class="flex justify-between items-end mb-4 px-2">
            <h4 class="font-bold text-slate-700">Histórico de Lançamentos</h4>
            
            <div class="flex items-center gap-2 bg-white p-1 rounded-lg border border-slate-200 shadow-sm">
                <input type="month" id="filtroHistoricoFolha" onchange="folha.carregarFolhas()" class="text-xs border-0 outline-none bg-transparent font-bold text-slate-600 px-2 cursor-pointer">
                <button onclick="folha.limparFiltro()" class="text-slate-400 hover:text-red-500 p-1 transition" title="Limpar Filtro">
                    <i class="fa-solid fa-eraser"></i>
                </button>
                <div class="w-px h-4 bg-slate-200 mx-1"></div>
                <button onclick="folha.carregarFolhas()" class="text-blue-600 hover:bg-blue-50 p-1 rounded transition text-xs" title="Atualizar">
                    <i class="fa-solid fa-rotate"></i>
                </button>
            </div>
        </div>

        <div class="card-dashboard overflow-hidden p-0 border-none shadow-lg">
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left border-collapse">
                    <thead class="bg-slate-50 text-slate-500 uppercase text-[10px] font-bold border-b border-slate-200">
                        <tr>
                            <th class="px-6 py-3">Competência</th>
                            <th class="px-4 py-3">Tipo</th>
                            <th class="px-4 py-3 text-right">Bruto</th>
                            <th class="px-4 py-3 text-right">Descontos</th>
                            <th class="px-4 py-3 text-right">Líquido</th>
                            <th class="px-6 py-3 text-center">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="listaFolhas" class="divide-y divide-slate-100 bg-white">
                        <!-- JS preenche dinamicamente -->
                    </tbody>
                    <!-- RODAPÉ DE TOTAIS -->
                    <tfoot class="bg-yellow-100 font-bold text-slate-800 border-t-2 border-yellow-300">
                        <tr>
                            <td colspan="2" class="px-6 py-4 text-right uppercase text-[11px] tracking-wider">Total da Competência:</td>
                            <td class="px-4 py-4 text-right text-emerald-700" id="totalCompFolhaBruto">R$ 0,00</td>
                            <td class="px-4 py-4 text-right text-red-600" id="totalCompFolhaDesc">R$ 0,00</td>
                            <td class="px-4 py-4 text-right font-black text-slate-900 text-lg" id="totalCompFolhaLiq">R$ 0,00</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- VIEW 2: OUTROS BANCOS (REMESSAS) -->
    <div id="view-folha-outros-bancos" class="hidden space-y-6">
        
        <!-- Barra de Controle -->
        <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-3">
                <label class="text-sm font-bold text-slate-600">Competência de Trabalho:</label>
                <input type="month" id="filtroCompOutrosBancos" onchange="folha.carregarOutrosBancos()" class="input-padrao w-40 font-bold text-indigo-700 border-indigo-200">
            </div>
            
            <button onclick="folha.importarMesAnterior()" class="btn-secondary text-xs border-indigo-200 text-indigo-600 hover:bg-indigo-50 w-full md:w-auto">
                <i class="fa-solid fa-copy mr-2"></i> Importar do Mês Anterior
            </button>
        </div>

        <!-- KPIs Financeiros -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm relative overflow-hidden">
                <div class="absolute right-0 top-0 p-3 opacity-10"><i class="fa-solid fa-sack-dollar text-4xl"></i></div>
                <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Total Líquido (Folha)</p>
                <h3 id="kpiFolhaLiquida" class="text-2xl font-black text-slate-800 mt-1">R$ 0,00</h3>
                <p class="text-[10px] text-slate-400 mt-1">Base de Cálculo</p>
            </div>
            <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-100 shadow-sm relative overflow-hidden">
                <div class="absolute right-0 top-0 p-3 opacity-10"><i class="fa-solid fa-building-columns text-4xl text-indigo-900"></i></div>
                <p class="text-xs font-bold text-indigo-400 uppercase tracking-widest">Repasse Outros Bancos</p>
                <h3 id="kpiOutrosBancos" class="text-2xl font-black text-indigo-700 mt-1">R$ 0,00</h3>
                <p class="text-[10px] text-indigo-400 mt-1">Soma das remessas abaixo</p>
            </div>
            <div class="bg-emerald-50 p-4 rounded-xl border border-emerald-100 shadow-sm relative overflow-hidden">
                <div class="absolute right-0 top-0 p-3 opacity-10"><i class="fa-solid fa-landmark text-4xl text-emerald-900"></i></div>
                <p class="text-xs font-bold text-emerald-500 uppercase tracking-widest">Repasse Banco Principal</p>
                <h3 id="kpiBancoPrincipal" class="text-2xl font-black text-emerald-700 mt-1">R$ 0,00</h3>
                <p class="text-[10px] text-emerald-500 mt-1">Líquido (-) Outros Bancos</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Formulário Lateral (Remessa) -->
            <div class="lg:col-span-1">
                <div class="card-dashboard p-5 border-l-4 border-l-indigo-500 h-full">
                    <h4 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-plus-circle text-indigo-500"></i> Nova Remessa
                    </h4>
                    
                    <form id="formOutrosBancos" onsubmit="folha.handleSaveOutrosBancos(event)" class="space-y-4">
                        <input type="hidden" name="id" id="idRemessaEdicao">
                        <input type="hidden" name="idServidor" id="idServidorOB">
                        <input type="hidden" name="nomeServidor" id="nomeServidorOB">
                        <input type="hidden" name="cpf" id="cpfServidorOB">

                        <div class="relative">
                            <label class="label-padrao">Buscar Servidor</label>
                            <input type="text" id="buscaServidorOB" class="input-padrao font-bold text-indigo-900" placeholder="Digite o nome..." oninput="folha.buscarServidor(this)" autocomplete="off">
                            <div id="listaSugestoesOB" class="autocomplete-list"></div>
                        </div>

                        <div id="detalhesServidorOB" class="hidden bg-slate-50 p-3 rounded border border-slate-100 text-xs space-y-1">
                            <p><strong>Nome:</strong> <span id="lblNomeOB">...</span></p>
                            <p><strong>CPF:</strong> <span id="lblCpfOB">...</span></p>
                        </div>

                        <div>
                            <label class="label-padrao">Banco de Destino</label>
                            <select name="banco" id="selectBancoOB" class="input-padrao" required>
                                <option value="">Selecione...</option>
                                <option value="Banco do Brasil">Banco do Brasil</option>
                                <option value="Caixa Econômica">Caixa Econômica</option>
                                <option value="Bradesco">Bradesco</option>
                                <option value="Santander">Santander</option>
                                <option value="Itaú">Itaú</option>
                                <option value="Sicoob">Sicoob</option>
                                <option value="Sicredi">Sicredi</option>
                                <option value="Nubank">Nubank</option>
                                <option value="Inter">Inter</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>

                        <div>
                            <label class="label-padrao">Valor Líquido (R$)</label>
                            <input type="text" name="valor" id="valorOB" required class="input-padrao mask-money font-bold text-lg text-emerald-600">
                        </div>

                        <div>
                            <label class="label-padrao">Observações</label>
                            <input type="text" name="observacoes" id="obsOB" class="input-padrao">
                        </div>

                        <div class="pt-2 flex gap-2">
                            <button type="submit" id="btnSalvarOB" class="btn-primary w-full bg-indigo-600 hover:bg-indigo-700 border-none justify-center">
                                <i class="fa-solid fa-plus"></i> Adicionar
                            </button>
                            <button type="button" onclick="folha.cancelarEdicaoOB()" id="btnCancelOB" class="btn-secondary hidden text-red-500 border-red-200">
                                <i class="fa-solid fa-times"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Tabela de Remessas -->
            <div class="lg:col-span-2">
                <div class="card-dashboard overflow-hidden p-0 h-full flex flex-col">
                    <div class="px-5 py-3 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                        <h4 class="font-bold text-slate-700 text-sm">Lista de Remessas</h4>
                        <span class="text-[10px] bg-white border border-slate-200 px-2 py-1 rounded text-slate-500" id="contadorRemessas">0 registros</span>
                    </div>
                    
                    <div class="flex-1 overflow-y-auto max-h-[500px]">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-white text-slate-500 font-semibold uppercase text-[10px] sticky top-0 shadow-sm z-10">
                                <tr>
                                    <th class="pl-5 py-3">Servidor / CPF</th>
                                    <th class="px-4 py-3">Banco</th>
                                    <th class="px-4 py-3 text-right">Valor</th>
                                    <th class="pr-5 py-3 text-center w-24">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="listaOutrosBancos" class="divide-y divide-slate-100">
                                <!-- JS preenche -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW 3: GERENCIAL (RELATÓRIO ANUAL) -->
    <div id="view-folha-gerencial" class="hidden">
        <div class="card-dashboard p-6">
            <div class="flex items-center justify-between mb-6">
                <h4 class="font-bold text-slate-800">Relatório Anual de Folha</h4>
                <select id="filtroAnoFolha" onchange="folha.renderizarRelatorio()" class="input-padrao py-1 w-24 font-bold border-slate-200 bg-slate-50">
                    <!-- JS popula -->
                </select>
            </div>

            <div class="overflow-x-auto rounded-lg border border-slate-200">
                <table class="w-full text-sm">
                    <thead class="bg-slate-800 text-white font-bold">
                        <tr>
                            <th class="px-6 py-3 text-left">Mês</th>
                            <th class="px-4 py-3 text-right">Bruto</th>
                            <th class="px-4 py-3 text-right">Descontos</th>
                            <th class="px-4 py-3 text-right">Líquido</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaRelatorioAnual" class="divide-y divide-slate-100 bg-white">
                        <!-- JS popula -->
                    </tbody>
                    <tfoot class="bg-slate-100 font-bold border-t border-slate-300">
                        <tr>
                            <td class="px-6 py-3 text-right uppercase text-[10px]">Total Consolidado:</td>
                            <td class="px-4 py-3 text-right" id="totalAnoBruto">R$ 0,00</td>
                            <td class="px-4 py-3 text-right" id="totalAnoDesc">R$ 0,00</td>
                            <td class="px-4 py-3 text-right text-lg font-black" id="totalAnoLiq">R$ 0,00</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

</div>
